<!DOCTYPE html>
<html>
  <head>
    <title>BaycosmeSaas</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    
    <!-- Rails UJS for form submission -->
    <script src="https://unpkg.com/@rails/ujs@6.0.0/lib/assets/compiled/rails-ujs.js"></script>
    <script>
      Rails.start();
    </script>
  </head>

  <body>
    <!-- フラッシュメッセージ -->
    <%= render 'shared/flash_messages' %>
    
    <% if user_signed_in? %>
      <!-- SaaS Style Layout with Sidebar -->
      <div class="saas-layout">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
          <div class="sidebar-header">
            <div class="logo">
              <span class="logo-icon">⚡</span>
              <span class="logo-text">ベイコスメティックス アプリ</span>
            </div>
          </div>
          
          <nav class="sidebar-nav">
            <ul class="nav-menu">
              <li class="nav-item">
                <%= link_to dashboard_path, class: "nav-link #{'active' if controller_name == 'users' && action_name == 'show'}" do %>
                  <span class="nav-icon">🏠</span>
                  <span class="nav-text">ダッシュボード</span>
                <% end %>
              </li>
              
              <li class="nav-item">
                <%= link_to new_cosmetic_formulation_path, class: "nav-link #{'active' if controller_name == 'cosmetic_formulations' && action_name == 'new'}" do %>
                  <span class="nav-icon">🧬</span>
                  <span class="nav-text">新規処方</span>
                <% end %>
              </li>
              
              <li class="nav-item">
                <%= link_to cosmetic_formulations_path, class: "nav-link #{'active' if controller_name == 'cosmetic_formulations' && action_name == 'index'}" do %>
                  <span class="nav-icon">📚</span>
                  <span class="nav-text">処方履歴</span>
                <% end %>
              </li>
              
              <li class="nav-item">
                <%= link_to samples_path, class: "nav-link #{'active' if controller_name == 'samples'}" do %>
                  <span class="nav-icon">🧪</span>
                  <span class="nav-text">サンプル一覧</span>
                <% end %>
              </li>
              
              <li class="nav-item">
                <%= link_to sample_orders_path, class: "nav-link #{'active' if controller_name == 'sample_orders'}" do %>
                  <span class="nav-icon">📋</span>
                  <span class="nav-text">サンプル注文</span>
                <% end %>
              </li>
              
              <li class="nav-item">
                <%= link_to edit_user_registration_path, class: "nav-link #{'active' if controller_name == 'registrations' && action_name == 'edit'}" do %>
                  <span class="nav-icon">⚙️</span>
                  <span class="nav-text">設定</span>
                <% end %>
              </li>
            </ul>
            
            <div class="sidebar-footer">
              <div class="user-info">
                <div class="user-avatar">
                  <div class="avatar-placeholder">👤</div>
                </div>
                <div class="user-details">
                  <div class="user-name"><%= current_user.display_name %></div>
                  <div class="user-email"><%= current_user.email %></div>
                </div>
              </div>
              
              <%= link_to destroy_user_session_path, data: { method: :delete, confirm: "ログアウトしますか？" }, class: "logout-btn" do %>
                <span class="nav-icon">🚪</span>
                <span class="nav-text">ログアウト</span>
              <% end %>
            </div>
          </nav>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
          <!-- Top Header for logged-in users -->
          <div class="top-header">
            <div class="header-left">
              <h1 class="page-title">
                <% case controller_name %>
                <% when 'users' %>
                  <% if action_name == 'show' %>
                    🏠 ダッシュボード
                  <% elsif action_name == 'edit' %>
                    ⚙️ プロフィール設定
                  <% end %>
                <% when 'cosmetic_formulations' %>
                  <% if action_name == 'new' %>
                    🧬 新しい処方を作成
                  <% elsif action_name == 'index' %>
                    📚 処方履歴
                  <% elsif action_name == 'show' %>
                    🧪 処方詳細
                  <% end %>
                <% when 'samples' %>
                  <% if action_name == 'index' %>
                    🧪 サンプル一覧
                  <% elsif action_name == 'show' %>
                    🧴 サンプル詳細
                  <% end %>
                <% when 'sample_orders' %>
                  <% if action_name == 'index' %>
                    📋 サンプル注文履歴
                  <% elsif action_name == 'new' %>
                    🛒 サンプル注文
                  <% elsif action_name == 'show' %>
                    📋 注文詳細
                  <% end %>
                <% when 'home' %>
                  🏠 ホーム
                <% else %>
                  ベイコスメティックス アプリ
                <% end %>
              </h1>
            </div>
            
            <div class="header-right">
              <div class="profile-completion">
                <span class="completion-label">完成度:</span>
                <span class="completion-percentage"><%= current_user.profile_completion_percentage %>%</span>
                <div class="completion-bar">
                  <div class="completion-fill" style="width: <%= current_user.profile_completion_percentage %>%;"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Content Area -->
          <div class="content-area">
            <%= yield %>
          </div>
        </div>
      </div>
    <% else %>
      <!-- Guest Layout (No Sidebar) -->
      <div class="guest-layout">
        <%= yield %>
      </div>
    <% end %>
  </body>
</html>
