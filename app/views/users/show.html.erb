<!-- Business Dashboard Overview -->
<div class="dashboard-overview">
  <div class="dashboard-header">
    <div>
      <h1>ようこそ、<%= @user.display_name %>さん</h1>
      <p class="dashboard-subtitle">AI化粧品処方開発システム - 企画管理ダッシュボード</p>
    </div>
    <div class="header-actions">
      <%= link_to "プロフィール編集", edit_user_registration_path, class: "btn btn-outline" %>
      <%= link_to "新規企画開発", new_cosmetic_formulation_path, class: "btn btn-primary" %>
    </div>
  </div>
</div>

<!-- Key Performance Indicators -->
<div class="kpi-grid">
  <div class="dashboard-widget">
    <div class="widget-header">
      <h3 class="widget-title">総企画数</h3>
      <a href="<%= cosmetic_formulations_path %>" class="widget-action">すべて表示</a>
    </div>
    <div class="widget-content">
      <div class="metric-value"><%= @user.cosmetic_formulations.count %></div>
      <div class="metric-label">開発済み企画</div>
      <div class="metric-change positive">
        <span>↗</span> +<%= @user.formulations_this_month %> 今月
      </div>
    </div>
  </div>
  
  <div class="dashboard-widget">
    <div class="widget-header">
      <h3 class="widget-title">月間開発数</h3>
      <span class="widget-action">この月</span>
    </div>
    <div class="widget-content">
      <div class="metric-value"><%= @user.formulations_this_month %></div>
      <div class="metric-label">今月の企画開発</div>
      <div class="metric-change <%= @user.formulations_this_month > 2 ? 'positive' : 'neutral' %>">
        <% if @user.formulations_this_month > 2 %>
          <span>📈</span> 順調です
        <% else %>
          <span>📊</span> 平均的
        <% end %>
      </div>
    </div>
  </div>
  
  <div class="dashboard-widget">
    <div class="widget-header">
      <h3 class="widget-title">お気に入りタイプ</h3>
      <span class="widget-action">分析</span>
    </div>
    <div class="widget-content">
      <div class="metric-value" style="font-size: 24px;"><%= @user.favorite_product_type %></div>
      <div class="metric-label">最も多く作成</div>
      <div class="metric-change info">
        <span>🔍</span> 傾向分析
      </div>
    </div>
  </div>
  
  <div class="dashboard-widget">
    <div class="widget-header">
      <h3 class="widget-title">プロフィール完成度</h3>
      <%= link_to "更新", edit_user_registration_path, class: "widget-action" %>
    </div>
    <div class="widget-content">
      <div class="metric-value"><%= @user.profile_completion_percentage %>%</div>
      <div class="metric-label">プロフィール情報</div>
      <div class="completion-progress-bar">
        <div class="progress-fill" style="width: <%= @user.profile_completion_percentage %>%;"></div>
      </div>
      <div class="metric-change <%= @user.profile_completion_percentage == 100 ? 'positive' : 'warning' %>">
        <% if @user.profile_completion_percentage == 100 %>
          <span>✅</span> 完了
        <% else %>
          <span>⚠️</span> 未完了項目あり
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Profile Completion Alert -->
<% if @user.profile_completion_percentage < 100 %>
  <div class="alert notice" style="margin-bottom: 2rem;">
    <strong>プロフィール未完了:</strong> プロフィールを完成させて、より精密な処方提案を受けましょう。
    <%= link_to "プロフィールを編集", edit_user_registration_path, class: "btn btn-primary btn-small", style: "margin-left: 1rem;" %>
  </div>
<% end %>

<!-- Company Information Section -->
<% if @user.company %>
  <div class="card" style="margin-bottom: 2rem;">
    <div class="card-header">
      <h3 class="card-title">🏢 会社情報</h3>
      <p class="card-subtitle">所属企業の詳細情報</p>
    </div>
    <div class="card-content">
      <div class="info-grid">
        <div class="info-item">
          <label class="info-label">会社名</label>
          <div class="info-value"><%= @user.company.name %></div>
        </div>
        <div class="info-item">
          <label class="info-label">住所</label>
          <div class="info-value"><%= @user.company.address %></div>
        </div>
        <div class="info-item">
          <label class="info-label">従業員数</label>
          <div class="info-value"><%= @user.company.employee_count || '未設定' %>人</div>
        </div>
        <div class="info-item">
          <label class="info-label">プラン</label>
          <div class="info-value">
            <span class="status-badge status-info"><%= @user.company.plan_name %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<!-- Recent Formulations Activity -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">最近の企画開発活動</h3>
    <%= link_to "すべて表示", cosmetic_formulations_path, class: "btn btn-outline btn-small" %>
  </div>
  <div class="card-content">
    <% if @formulations.any? %>
      <div class="formulation-list">
        <% @formulations.each do |formulation| %>
          <div class="formulation-item">
            <div class="formulation-info">
              <div class="formulation-title">
                <%= link_to formulation.product_type_name, formulation, class: "formulation-link" %>
                <span class="status-badge status-success">完了</span>
              </div>
              <div class="formulation-meta">
                <span class="meta-tag"><%= formulation.skin_type_name %></span>
                <span class="meta-tag"><%= formulation.target_age_name %></span>
                <span class="meta-date"><%= formulation.created_at.strftime("%Y年%m月%d日") %></span>
              </div>
              <p class="formulation-concerns"><%= truncate(formulation.concerns, length: 80) %></p>
            </div>
            <div class="formulation-actions">
              <%= link_to "詳細", formulation, class: "btn btn-outline btn-small" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <div class="empty-content">
          <h4>まだ企画がありません</h4>
          <p>最初の化粧品企画を開始して、AI による高精度な処方提案を体験しましょう。</p>
          <%= link_to "新規企画を開発", new_cosmetic_formulation_path, class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Quick Actions Panel -->
<div class="card" style="margin-top: 2rem;">
  <div class="card-header">
    <h3 class="card-title">クイックアクション</h3>
    <p class="card-subtitle">よく使う機能に素早くアクセス</p>
  </div>
  <div class="card-content">
    <div class="quick-actions-grid">
      <%= link_to new_cosmetic_formulation_path, class: "quick-action-item" do %>
        <div class="action-icon">🧬</div>
        <div class="action-content">
          <div class="action-title">新規企画開発</div>
          <div class="action-desc">AIを使って新しい化粧品企画を開発</div>
        </div>
      <% end %>
      
      <%= link_to cosmetic_formulations_path, class: "quick-action-item" do %>
        <div class="action-icon">📊</div>
        <div class="action-content">
          <div class="action-title">企画管理</div>
          <div class="action-desc">開発した企画の閲覧・管理</div>
        </div>
      <% end %>
      
      <%= link_to edit_user_registration_path, class: "quick-action-item" do %>
        <div class="action-icon">⚙️</div>
        <div class="action-content">
          <div class="action-title">アカウント設定</div>
          <div class="action-desc">プロフィール・設定の変更</div>
        </div>
      <% end %>
    </div>
  </div>
</div>
