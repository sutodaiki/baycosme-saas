<div class="sample-order-page">
  <!-- сЃЉсЃ│сЂЈсЂџсЃісЃЊ -->
  <nav class="breadcrumb">
    <% if @sample %>
      <%= link_to sample_path(@sample), class: "breadcrumb-link" do %>
        Рєљ <%= @sample.name %> сЂФТѕ╗сѓІ
      <% end %>
    <% else %>
      <%= link_to samples_path, class: "breadcrumb-link" do %>
        Рєљ сѓхсЃ│сЃЌсЃФСИђУдДсЂФТѕ╗сѓІ
      <% end %>
    <% end %>
  </nav>

  <div class="order-container">
    <!-- сѓхсЃ│сЃЌсЃФТЃЁта▒ -->
    <div class="sample-info-card">
      <div class="sample-summary">
        <div class="sample-image-mini">
          <% if @sample&.image_url.present? %>
            <%= image_tag @sample.image_url, alt: @sample.name %>
          <% else %>
            <div class="sample-placeholder-mini">­ЪД┤</div>
          <% end %>
        </div>
        <div class="sample-details">
          <h3 class="sample-name"><%= @sample&.name || 'сѓФсѓ╣сѓ┐сЃасѓхсЃ│сЃЌсЃФ' %></h3>
          <p class="sample-type"><%= @sample&.product_type %></p>
          <p class="sample-price"><%= @sample&.display_price || 'СЙАТа╝Тюфт«џ' %></p>
        </div>
      </div>
    </div>

    <!-- Т│еТќЄсЃЋсѓЕсЃ╝сЃа -->
    <div class="order-form-card">
      <h1 class="form-title">­ЪЏњ сѓхсЃ│сЃЌсЃФТ│еТќЄ</h1>
      <p class="form-description">С╗ЦСИІсЂ«жаЁуЏ«сѓњтЁЦтіЏсЂЌсЂдсѓхсЃ│сЃЌсЃФТ│еТќЄсѓњуб║т«џсЂЌсЂдсЂЈсЂасЂЋсЂё</p>

      <%= form_with model: @sample_order, local: true, class: "order-form" do |f| %>
        <% if @sample %>
          <%= f.hidden_field :sample_id, value: @sample.id %>
        <% end %>

        <!-- сѓесЃЕсЃ╝сЃАсЃЃсѓ╗сЃ╝сѓИ -->
        <% if @sample_order.errors.any? %>
          <div class="error-messages">
            <h4>тЁЦтіЏсѓесЃЕсЃ╝сЂїсЂѓсѓісЂЙсЂЎ:</h4>
            <ul>
              <% @sample_order.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="form-sections">
          <!-- тЪ║ТюгТЃЁта▒ -->
          <div class="form-section">
            <h3 class="section-title">тЪ║ТюгТЃЁта▒</h3>
            
            <div class="form-group">
              <%= f.label :quantity, "ТЋ░жЄЈ", class: "form-label" %>
              <%= f.number_field :quantity, min: 1, max: 10, value: 1, class: "form-control", required: true %>
              <small class="form-help">ТюђтцД10тђІсЂЙсЂДТ│еТќЄтЈ»УЃйсЂДсЂЎ</small>
            </div>

            <div class="form-group">
              <%= f.label :priority, "тёфтЁѕт║д", class: "form-label" %>
              <%= f.select :priority, options_from_collection_for_select(SampleOrder::PRIORITIES.map { |name, value| OpenStruct.new(name: name, value: value) }, :value, :name, 'normal'), {}, { class: "form-control" } %>
              <small class="form-help">уиіТђЦсЃ╗жФўтёфтЁѕт║дсЂ»У┐йтіаТќЎжЄЉсЂїсЂІсЂІсѓісЂЙсЂЎ</small>
            </div>
          </div>

          <!-- жЁЇжђЂтЁѕТЃЁта▒ -->
          <div class="form-section">
            <h3 class="section-title">жЁЇжђЂтЁѕТЃЁта▒</h3>
            
            <div class="form-group">
              <div class="address-option">
                <%= f.radio_button :use_company_address, true, checked: true, id: "use_company_address", class: "address-radio" %>
                <%= f.label :use_company_address, "С╝џуцЙСйЈТЅђсЂетљїсЂў", for: "use_company_address", class: "radio-label" %>
              </div>
              <div class="address-option">
                <%= f.radio_button :use_company_address, false, id: "use_different_address", class: "address-radio" %>
                <%= f.label :use_company_address, "тѕЦсЂ«СйЈТЅђсЂФжЁЇжђЂ", for: "use_different_address", class: "radio-label" %>
              </div>
            </div>
            
            <div id="company-address-display" class="company-address-section">
              <div class="address-display">
                <% if current_user.company %>
                  <div class="address-info">
                    <h4 class="company-name"><%= current_user.company.name %></h4>
                    <% if current_user.company.postal_code %>
                      <p class="address-line">сђњ<%= current_user.company.postal_code %></p>
                    <% end %>
                    <% if current_user.company.address %>
                      <p class="address-line"><%= current_user.company.address %></p>
                    <% end %>
                  </div>
                <% else %>
                  <p class="no-company-info">С╝џуцЙТЃЁта▒сЂїУеГт«џсЂЋсѓїсЂдсЂёсЂЙсЂЏсѓЊ</p>
                <% end %>
              </div>
            </div>
            
            <div id="different-address-form" class="different-address-section" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <%= f.label :delivery_postal_code, "жЃхСЙ┐уЋфтЈи", class: "form-label" %>
                  <%= f.text_field :delivery_postal_code, placeholder: "123-4567", class: "form-control" %>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group half-width">
                  <%= f.label :delivery_prefecture, "жЃйжЂЊт║юуюї", class: "form-label" %>
                  <%= f.select :delivery_prefecture, 
                      options_for_select([
                        ['тїЌТхижЂЊ', 'тїЌТхижЂЊ'], ['жЮњТБ«уюї', 'жЮњТБ«уюї'], ['т▓ЕТЅІуюї', 'т▓ЕТЅІуюї'], ['т««тЪјуюї', 'т««тЪјуюї'],
                        ['уДІућ░уюї', 'уДІућ░уюї'], ['т▒▒тйбуюї', 'т▒▒тйбуюї'], ['удЈт│Хуюї', 'удЈт│Хуюї'], ['УїетЪјуюї', 'УїетЪјуюї'],
                        ['ТаЃТюеуюї', 'ТаЃТюеуюї'], ['уЙцждгуюї', 'уЙцждгуюї'], ['тЪ╝ујЅуюї', 'тЪ╝ујЅуюї'], ['тЇЃУЉЅуюї', 'тЇЃУЉЅуюї'],
                        ['ТЮ▒С║гжЃй', 'ТЮ▒С║гжЃй'], ['уЦътЦѕтиЮуюї', 'уЦътЦѕтиЮуюї'], ['Тќ░ТйЪуюї', 'Тќ░ТйЪуюї'], ['т»їт▒▒уюї', 'т»їт▒▒уюї'],
                        ['уЪ│тиЮуюї', 'уЪ│тиЮуюї'], ['удЈС║Ћуюї', 'удЈС║Ћуюї'], ['т▒▒Тбеуюї', 'т▒▒Тбеуюї'], ['жЋижЄјуюї', 'жЋижЄјуюї'],
                        ['т▓љжўюуюї', 'т▓љжўюуюї'], ['жЮЎт▓Ауюї', 'жЮЎт▓Ауюї'], ['ТёЏуЪЦуюї', 'ТёЏуЪЦуюї'], ['СИЅжЄЇуюї', 'СИЅжЄЇуюї'],
                        ['Т╗ІУ│ђуюї', 'Т╗ІУ│ђуюї'], ['С║гжЃйт║ю', 'С║гжЃйт║ю'], ['тцДжўфт║ю', 'тцДжўфт║ю'], ['тЁхт║Фуюї', 'тЁхт║Фуюї'],
                        ['тЦѕУЅ»уюї', 'тЦѕУЅ»уюї'], ['тњїТГїт▒▒уюї', 'тњїТГїт▒▒уюї'], ['ж│ЦтЈќуюї', 'ж│ЦтЈќуюї'], ['т│ХТа╣уюї', 'т│ХТа╣уюї'],
                        ['т▓Ат▒▒уюї', 'т▓Ат▒▒уюї'], ['т║Ѓт│Хуюї', 'т║Ѓт│Хуюї'], ['т▒▒тЈБуюї', 'т▒▒тЈБуюї'], ['тЙ│т│Хуюї', 'тЙ│т│Хуюї'],
                        ['ждЎтиЮуюї', 'ждЎтиЮуюї'], ['ТёЏтфЏуюї', 'ТёЏтфЏуюї'], ['жФўуЪЦуюї', 'жФўуЪЦуюї'], ['удЈт▓Ауюї', 'удЈт▓Ауюї'],
                        ['СйљУ│ђуюї', 'СйљУ│ђуюї'], ['жЋит┤јуюї', 'жЋит┤јуюї'], ['уєіТюгуюї', 'уєіТюгуюї'], ['тцДтѕєуюї', 'тцДтѕєуюї'],
                        ['т««т┤јуюї', 'т««т┤јуюї'], ['ж╣┐тЁљт│Хуюї', 'ж╣┐тЁљт│Хуюї'], ['Т▓ќуИёуюї', 'Т▓ќуИёуюї']
                      ], { prompt: 'жЂИТіъсЂЌсЂдсЂЈсЂасЂЋсЂё' }), { class: "form-control" } %>
                </div>
                
                <div class="form-group half-width">
                  <%= f.label :delivery_city, "тИѓтї║ућ║ТЮЉ", class: "form-label" %>
                  <%= f.text_field :delivery_city, placeholder: "ТИІУ░итї║", class: "form-control" %>
                </div>
              </div>
              
              <div class="form-group">
                <%= f.label :delivery_street, "уЋфтю░сЃ╗СИЂуЏ«", class: "form-label" %>
                <%= f.text_field :delivery_street, placeholder: "уЦътЇЌ1-2-3", class: "form-control" %>
              </div>
              
              <div class="form-group">
                <%= f.label :delivery_building, "т╗║уЅЕтљЇсЃ╗жЃет▒ІуЋфтЈи", class: "form-label" %>
                <%= f.text_field :delivery_building, placeholder: "РЌІРЌІсЃЊсЃФ 101тЈит«ц№╝ѕС╗╗ТёЈ№╝Ѕ", class: "form-control" %>
              </div>
            </div>
          </div>

          <!-- тѓЎУђЃ -->
          <div class="form-section">
            <h3 class="section-title">тѓЎУђЃсЃ╗УдЂТюЏ</h3>
            
            <div class="form-group">
              <%= f.label :notes, "тѓЎУђЃсЃ╗уЅ╣тѕЦсЂфУдЂТюЏ", class: "form-label" %>
              <%= f.text_area :notes, rows: 4, class: "form-control", 
                  placeholder: "жЁЇжђЂсЂФжќбсЂЎсѓІуЅ╣тѕЦсЂфУдЂТюЏсѓёсђЂсѓхсЃ│сЃЌсЃФсЂФсЂцсЂёсЂдуЪЦсѓісЂЪсЂёсЂЊсЂесЂфсЂЕсѓњсЂіТЏИсЂЇсЂЈсЂасЂЋсЂё№╝ѕС╗╗ТёЈ№╝Ѕ" %>
              <small class="form-help">ТюђтцД1000ТќЄтГЌсЂЙсЂД</small>
            </div>
          </div>

          <!-- Т│еТќЄуб║УфЇ -->
          <div class="form-section order-summary">
            <h3 class="section-title">Т│еТќЄтєЁт«╣сЂ«уб║УфЇ</h3>
            
            <div class="summary-grid">
              <div class="summary-item">
                <span class="summary-label">тЋєтЊЂ:</span>
                <span class="summary-value"><%= @sample&.name || 'сѓФсѓ╣сѓ┐сЃасѓхсЃ│сЃЌсЃФ' %></span>
              </div>
              <div class="summary-item">
                <span class="summary-label">ТЋ░жЄЈ:</span>
                <span class="summary-value" id="summary-quantity">1тђІ</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">тёфтЁѕт║д:</span>
                <span class="summary-value" id="summary-priority">жђџтИИ</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">тЪ║ТюгТќЎжЄЉ:</span>
                <span class="summary-value" id="summary-price"><%= @sample&.display_price || '┬Ц2,000' %></span>
              </div>
              <div class="summary-item total">
                <span class="summary-label">С║ѕТЃ│тљѕУеѕ:</span>
                <span class="summary-value" id="summary-total">┬Ц2,000</span>
              </div>
            </div>
            
            <p class="pricing-note">
              Рђ╗ ТюђухѓуџёсЂфТќЎжЄЉсЂ»у«АуљєУђЁсЂФсѓѕсѓІуб║УфЇтЙїсЂФуб║т«џсЂЋсѓїсЂЙсЂЎ<br>
              Рђ╗ жђЂТќЎсЂ»тѕЦжђћсЂІсЂІсѓісЂЙсЂЎ
            </p>
          </div>
        </div>

        <!-- жђЂС┐АсЃюсѓ┐сЃ│ -->
        <div class="form-actions">
          <%= f.submit "сѓхсЃ│сЃЌсЃФТ│еТќЄсѓњуб║т«џсЂЎсѓІ", class: "btn btn-primary btn-lg submit-btn" %>
          <% if @sample %>
            <%= link_to "сѓГсЃБсЃ│сѓ╗сЃФ", sample_path(@sample), class: "btn btn-outline btn-lg" %>
          <% else %>
            <%= link_to "сѓГсЃБсЃ│сѓ╗сЃФ", samples_path, class: "btn btn-outline btn-lg" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const quantityField = document.querySelector('input[name="sample_order[quantity]"]');
  const priorityField = document.querySelector('select[name="sample_order[priority]"]');
  const basePrice = <%= @sample&.price || 2000 %>;
  
  // Address switching functionality
  const companyAddressRadio = document.getElementById('use_company_address');
  const differentAddressRadio = document.getElementById('use_different_address');
  const companyAddressDisplay = document.getElementById('company-address-display');
  const differentAddressForm = document.getElementById('different-address-form');
  
  function toggleAddressForm() {
    if (differentAddressRadio.checked) {
      companyAddressDisplay.style.display = 'none';
      differentAddressForm.style.display = 'block';
      
      // Make address fields required when using different address
      const addressFields = differentAddressForm.querySelectorAll('input, select');
      addressFields.forEach(field => {
        if (!field.id.includes('building')) { // Building is optional
          field.setAttribute('required', 'required');
        }
      });
    } else {
      companyAddressDisplay.style.display = 'block';
      differentAddressForm.style.display = 'none';
      
      // Remove required attribute when using company address
      const addressFields = differentAddressForm.querySelectorAll('input, select');
      addressFields.forEach(field => {
        field.removeAttribute('required');
      });
    }
  }
  
  companyAddressRadio.addEventListener('change', toggleAddressForm);
  differentAddressRadio.addEventListener('change', toggleAddressForm);
  
  // Initialize address form state
  toggleAddressForm();
  
  function updateSummary() {
    const quantity = parseInt(quantityField.value) || 1;
    const priority = priorityField.value;
    
    // тёфтЁѕт║дсЂ«УАеуц║тљЇсѓњТЏ┤Тќ░
    const priorityNames = {
      'normal': 'жђџтИИ',
      'high': 'жФў',
      'urgent': 'уиіТђЦ'
    };
    
    // тёфтЁѕт║дсЂ«тђЇујЄ
    const priorityMultipliers = {
      'normal': 1.0,
      'high': 1.5,
      'urgent': 2.0
    };
    
    const total = Math.round(basePrice * quantity * priorityMultipliers[priority]);
    
    document.getElementById('summary-quantity').textContent = quantity + 'тђІ';
    document.getElementById('summary-priority').textContent = priorityNames[priority];
    document.getElementById('summary-total').textContent = '┬Ц' + total.toLocaleString();
  }
  
  quantityField.addEventListener('input', updateSummary);
  priorityField.addEventListener('change', updateSummary);
  
  updateSummary();
});
</script>

<style>
.sample-order-page {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.breadcrumb {
  margin-bottom: 2rem;
}

.breadcrumb-link {
  color: #667eea;
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s ease;
}

.breadcrumb-link:hover {
  color: #5a67d8;
}

.order-container {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.sample-info-card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  border: 1px solid #f1f5f9;
}

.sample-summary {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.sample-image-mini {
  width: 80px;
  height: 80px;
  border-radius: 0.75rem;
  overflow: hidden;
  background: #f8fafc;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sample-image-mini img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sample-placeholder-mini {
  font-size: 2rem;
  opacity: 0.3;
}

.sample-details {
  flex: 1;
}

.sample-name {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0 0 0.25rem 0;
}

.sample-type {
  color: #667eea;
  font-size: 0.875rem;
  margin: 0 0 0.25rem 0;
  font-weight: 500;
}

.sample-price {
  color: #059669;
  font-size: 1.125rem;
  font-weight: 700;
  margin: 0;
}

.order-form-card {
  background: white;
  border-radius: 1rem;
  padding: 2rem;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  border: 1px solid #f1f5f9;
}

.form-title {
  font-size: 2rem;
  font-weight: 700;
  color: #1e293b;
  margin: 0 0 0.5rem 0;
  text-align: center;
}

.form-description {
  text-align: center;
  color: #64748b;
  margin-bottom: 2rem;
}

.error-messages {
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-bottom: 2rem;
  color: #991b1b;
}

.error-messages h4 {
  margin: 0 0 0.5rem 0;
  font-size: 0.875rem;
  font-weight: 600;
}

.error-messages ul {
  margin: 0;
  padding-left: 1.25rem;
}

.form-sections {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.form-section {
  border: 1px solid #e2e8f0;
  border-radius: 0.75rem;
  padding: 1.5rem;
}

.section-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #374151;
  margin: 0 0 1.5rem 0;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #f1f5f9;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group:last-child {
  margin-bottom: 0;
}

.form-label {
  display: block;
  font-weight: 500;
  color: #374151;
  margin-bottom: 0.5rem;
}

.form-control {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid #e2e8f0;
  border-radius: 0.5rem;
  font-size: 1rem;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-control:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-help {
  display: block;
  font-size: 0.75rem;
  color: #64748b;
  margin-top: 0.25rem;
}

.order-summary {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border-color: #cbd5e1;
}

.summary-grid {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid #e2e8f0;
}

.summary-item:last-child {
  border-bottom: none;
}

.summary-item.total {
  font-weight: 700;
  font-size: 1.125rem;
  border-top: 2px solid #cbd5e1;
  padding-top: 1rem;
  margin-top: 0.5rem;
}

.summary-label {
  color: #64748b;
  font-weight: 500;
}

.summary-value {
  color: #1e293b;
  font-weight: 600;
}

.summary-item.total .summary-value {
  color: #059669;
}

.pricing-note {
  font-size: 0.75rem;
  color: #64748b;
  font-style: italic;
  text-align: center;
  margin: 0;
  line-height: 1.5;
}

.address-option {
  margin-bottom: 1rem;
  padding: 1rem;
  border: 2px solid #e2e8f0;
  border-radius: 0.5rem;
  transition: border-color 0.2s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.address-option:hover {
  border-color: #cbd5e1;
}

.address-option:has(input[type="radio"]:checked) {
  border-color: #667eea;
  background: rgba(102, 126, 234, 0.05);
}

.address-radio {
  width: 1.125rem;
  height: 1.125rem;
  cursor: pointer;
}

.radio-label {
  font-weight: 500;
  color: #374151;
  cursor: pointer;
  margin: 0;
}

.company-address-section,
.different-address-section {
  margin-top: 1.5rem;
}

.address-display {
  background: #f0f9ff;
  border-radius: 0.75rem;
  padding: 1.5rem;
  border-left: 4px solid #0ea5e9;
}

.company-name {
  font-size: 1.125rem;
  font-weight: 600;
  color: #0c4a6e;
  margin: 0 0 0.5rem 0;
}

.address-line {
  color: #0c4a6e;
  margin: 0.25rem 0;
  line-height: 1.5;
}

.no-company-info {
  color: #ef4444;
  font-style: italic;
  margin: 0;
}

.form-row {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
}

.form-group.half-width {
  flex: 1;
  margin-bottom: 0;
}

.different-address-section .form-group:last-child {
  margin-bottom: 0;
}

.form-actions {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid #e2e8f0;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 1rem 2rem;
  border-radius: 0.75rem;
  font-size: 1rem;
  font-weight: 600;
  text-decoration: none;
  border: 2px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-lg {
  padding: 1.25rem 2rem;
  font-size: 1.125rem;
}

.btn-primary {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  color: white;
  border-color: transparent;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(5, 150, 105, 0.3);
}

.btn-outline {
  background: transparent;
  color: #667eea;
  border-color: #667eea;
}

.btn-outline:hover {
  background: #667eea;
  color: white;
}

.submit-btn {
  min-width: 250px;
}

@media (max-width: 768px) {
  .sample-order-page {
    padding: 1rem;
  }
  
  .order-form-card {
    padding: 1.5rem;
  }
  
  .form-section {
    padding: 1rem;
  }
  
  .form-actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .submit-btn {
    min-width: auto;
  }
  
  .summary-item {
    font-size: 0.875rem;
  }
}
</style>