<div class="admin-dashboard">
  <div class="admin-header">
    <h1>ğŸ¢ OEMç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    <p class="subtitle">åŒ–ç²§å“OEMäº‹æ¥­ã®ç®¡ç†ãƒ»åˆ†æã‚·ã‚¹ãƒ†ãƒ </p>
    <div class="admin-actions">
      <%= link_to "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ", destroy_admin_session_path, data: { method: :delete }, class: "btn btn-secondary" %>
    </div>
  </div>

  <!-- KPI Overview -->
  <div class="kpi-grid">
    <div class="dashboard-widget">
      <div class="widget-header">
        <h3 class="widget-title">ç·ç™»éŒ²ä¼æ¥­æ•°</h3>
      </div>
      <div class="widget-content">
        <div class="metric-value"><%= @total_companies %></div>
        <div class="metric-label">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¼æ¥­</div>
        <div class="metric-change positive">
          <span>ğŸ“ˆ</span> ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: <%= @active_companies %>ç¤¾
        </div>
      </div>
    </div>

    <div class="dashboard-widget">
      <div class="widget-header">
        <h3 class="widget-title">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</h3>
      </div>
      <div class="widget-content">
        <div class="metric-value"><%= @total_users %></div>
        <div class="metric-label">ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨è€…</div>
        <div class="metric-change info">
          <span>ğŸ‘¥</span> ä¼ç”»æ‹…å½“è€…
        </div>
      </div>
    </div>

    <div class="dashboard-widget">
      <div class="widget-header">
        <h3 class="widget-title">ç·å‡¦æ–¹é–‹ç™ºæ•°</h3>
      </div>
      <div class="widget-content">
        <div class="metric-value"><%= @total_formulations %></div>
        <div class="metric-label">AIå‡¦æ–¹ç”Ÿæˆ</div>
        <div class="metric-change positive">
          <span>ğŸ§ª</span> ä»Šæœˆ: <%= @monthly_formulations %>ä»¶
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="admin-content">
    <div class="admin-section">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">ğŸ¢ æœ€è¿‘ç™»éŒ²ã•ã‚ŒãŸä¼æ¥­</h3>
        </div>
        <div class="card-content">
          <% if @recent_companies.any? %>
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ä¼šç¤¾å</th>
                    <th>ä½æ‰€</th>
                    <th>å¾“æ¥­å“¡æ•°</th>
                    <th>ãƒ—ãƒ©ãƒ³</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                    <th>ç™»éŒ²æ—¥</th>
                  </tr>
                </thead>
                <tbody>
                  <% @recent_companies.each do |company| %>
                    <tr>
                      <td><strong><%= company.name %></strong></td>
                      <td><%= truncate(company.address, length: 40) %></td>
                      <td><%= company.employee_count %>äºº</td>
                      <td>
                        <span class="status-badge status-info">
                          <%= company.plan_name %>
                        </span>
                      </td>
                      <td>
                        <span class="status-badge <%= company.active? ? 'status-success' : 'status-warning' %>">
                          <%= company.status_name %>
                        </span>
                      </td>
                      <td><%= company.created_at.strftime("%Y/%m/%d") %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <p class="empty-message">ã¾ã ä¼æ¥­ã®ç™»éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          <% end %>
        </div>
      </div>
    </div>

    <div class="admin-section">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">ğŸ§ª æœ€è¿‘ã®å‡¦æ–¹é–‹ç™ºæ´»å‹•</h3>
        </div>
        <div class="card-content">
          <% if @recent_formulations.any? %>
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ä¼ç”»è€…</th>
                    <th>ä¼šç¤¾</th>
                    <th>å•†å“ã‚¿ã‚¤ãƒ—</th>
                    <th>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</th>
                    <th>é–‹ç™ºæ—¥æ™‚</th>
                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                  </tr>
                </thead>
                <tbody>
                  <% @recent_formulations.each do |formulation| %>
                    <tr>
                      <td><%= formulation.user.display_name %></td>
                      <td><%= formulation.user.company&.name || 'æœªæ‰€å±' %></td>
                      <td><strong><%= formulation.product_type_name %></strong></td>
                      <td>
                        <%= formulation.skin_type_name %> / 
                        <%= formulation.target_age_name %>
                      </td>
                      <td><%= formulation.created_at.strftime("%m/%d %H:%M") %></td>
                      <td>
                        <% if formulation.formulation.present? %>
                          <span class="status-badge status-success">å®Œäº†</span>
                        <% else %>
                          <span class="status-badge status-warning">å‡¦ç†ä¸­</span>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <p class="empty-message">ã¾ã å‡¦æ–¹é–‹ç™ºã®æ´»å‹•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.admin-dashboard {
  padding: var(--space-6);
  max-width: 1400px;
  margin: 0 auto;
}

.admin-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-8);
  
  h1 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }
  
  .subtitle {
    color: var(--text-secondary);
    margin: 0;
  }
}

.admin-content {
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.admin-section {
  width: 100%;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: var(--space-2);
  
  th, td {
    padding: var(--space-3);
    text-align: left;
    border-bottom: 1px solid var(--border-light);
  }
  
  th {
    background-color: var(--bg-secondary);
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
  }
  
  td {
    font-size: 14px;
    color: var(--text-primary);
  }
  
  tr:hover {
    background-color: var(--bg-secondary);
  }
}

.table-responsive {
  overflow-x: auto;
}

.empty-message {
  text-align: center;
  color: var(--text-secondary);
  font-style: italic;
  padding: var(--space-6);
}

@media (max-width: 768px) {
  .admin-header {
    flex-direction: column;
    gap: var(--space-4);
  }
  
  .kpi-grid {
    grid-template-columns: 1fr;
  }
  
  .admin-table {
    font-size: 12px;
    
    th, td {
      padding: var(--space-2);
    }
  }
}
</style>